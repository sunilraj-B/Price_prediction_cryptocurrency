{% load static %}
</html>
<!DOCTYPE html>
<html>
<head>
    <title>Crypton</title>

    <link rel="stylesheet" type="text/css" href="{% static 'updatecss.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'idecss.css' %}">
    
    <!-- <link rel="stylesheet" href="idecss.css"> -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            /* color: white; */
            margin: 0;
            padding: 0;
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;
            /* background-image: url("https://cdn.discordapp.com/attachments/822871611786657812/1125812524521107577/pngtree-colorful-light-effect-ray-background-picture-image_1219533-transformed.png"); */
            overflow-x: hidden;
        }
        
        header {
            padding-top: 20px;
            padding-bottom: 20px;
        }
        
        h2 {
            text-align: center;
            font-size: 24px;
        }
        img {
            width: 30px; /* Adjust the width of the image */
            margin-right: 10px; /* Adjust the spacing between the icon and text */
        }
         h1 {
            font-family:Cambria;
            text-align: center;
            font-size: 2.5rem; /* Adjust the font size as needed */
            color: #333; /* Dark Grey */
            transition: color 0.3s ease-in-out; /* Smooth color transition on hover */
            cursor: pointer;
        }
    
        h1:hover {
            color: #0066cc; /* A shade of blue for hover effect */
        }
        nav {
            display: flex;
            justify-content: space-between;
            background-color: #add8e6; /* Slightly darker light grey background color */
            padding: 10px 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        nav > ul {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
        }
        
        nav > ul > li {
            list-style-type: none;
            margin: 0;
            padding: 10px;
        }
        
        nav > ul > li > a {
            text-decoration: none;
            color: #000; /* Black text color */
            font-weight: bold;
            fontSize:16px;
            transition: color 0.3s ease-in-out;
        }
        
        nav > ul > li > a:hover {
            color: #f39c12; /* Orange color on hover */
        }
        
        /* Add a different style for the active link if needed */
        nav > ul > li > a.active {
            color: #f39c12; /* Orange color for active link */
        }
        
        /* Additional styling for special links, e.g., Future Predictions */
        nav > ul > li#futurePredictionsLink > a {
            background-color: #27ae60; /* Green background color for Future Predictions link */
            color: #fff;
        }
        
        /* Responsive styling for smaller screens */
        @media screen and (max-width: 768px) {
            nav {
                flex-direction: column;
                align-items: center;
            }
        
            nav > ul {
                flex-direction: column;
                text-align: center;
            }
        
            nav > ul > li {
                padding: 10px 0;
            }
        }
        
        
        .hero {
            padding: 0 3%;
        }
        
        #container {
            padding: 3%;
        }
        
        .contact-details {
            width: 100%;
            padding: 0 3%;
            display: flex;
            justify-content: center;
        }
        
        .contact-details > p {
            padding: 0 10px;
        } 
        
        .content-section {
            padding: 0 3%;
            text-align: justify;
        }
        
        footer {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin-bottom: 20px;
        }
        
        footer > p {
            font-size: small;
        }
        
        #searchInput {
            border-radius: 10px;
            width: 100px;
        }
        
        .search-container {
            width: 98%;
            padding: 10px;
            margin: 0%;
        }
        
        .social-icons {
            display: flex;
        }
        
        .icon {
            width: 40px;
            height: 40px;
            padding: 10px;
        }
     
        #searchInput {
            width: -webkit-fill-available;
            padding: 10px;
            font-size: 16px;
        }

        
        
        
        #searchResults {
            list-style-type: none;
            padding: 0;
            margin: 0;
            /* position: absolute; */
            z-index: 1;
            /* background-color: #fff; */
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            display: none;
        }
        
        
        #searchResults li {
            padding: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }
        
        #searchResults li img {
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }
        
        
        #searchResults li:hover {
            background-color: #f2f2f2;
        }
        
        #selectedCurrency {
            text-align: center;
            margin-bottom: 20px;
            min-height: 30%;
        }
        
        #coinInfo {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #coinImageContainer {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 20px;
        }
        
        #coinImage {
            width: 20%;
            height: auto;
        }
        
        #infoContainer {
            text-align: left;
        }
        
        .info-item {
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .chart {
            width: 50%;
            padding: 10px;
            box-sizing: border-box;
        }
  
        #currencyMenu {
            list-style-type: none;
            padding: 0;
        }
        
        #currencyMenu li {
            cursor: pointer;
            padding: 5px;
        }
        
        #currencyMenu li:hover {
            background-color: #e0e0e0;
        }
        
        #container {
            display: flex;
            flex-direction: row;
            max-width: 100%;
        }
        
        #selectedCurrency {
            background-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .charts-container {
           display: flex;
           height: fit-content;
           min-height: 30%;
        }
        
        .chart {
            flex-grow: 1;
            background-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        
    
        
        
        #container {
            display: flex;
            height: 100vh;
        }
        

        #leftPanel {
            height: auto;
            max-height: calc(100vh - 40px); /* Adjust the value based on your layout */
            overflow-y: auto;
        }
        
        #rightPanel {
            flex-grow: 1;
            display: flex;
            height: auto;
            max-height: calc(100vh - 40px); /* Adjust the value based on your layout */
            overflow-y: auto;
            overflow-x: hidden
        }
        
        .container {
            flex-grow: 1;
            max-width: 100%;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            height: 100%;
        }
        
        .currency-menu {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        
        .currency-menu li {
            display: flex;
            align-items: center;
            padding: 10px;
            cursor: pointer;
        }
        
        .table-header {
            font-weight: bold;
            background-color: #f5f5f5;
        }
        
        .serial-number {
            width: 50px;
        }
        
        .coin-info {
            flex-grow: 1;
        }
        
     
        
        .currency-info {
            display: flex;
            align-items: center;
        }

        #currencyContainer {
            overflow: auto;
        }
        
        .currency-menu {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table-header {
            position: sticky;
            top: 0;
            background-color: #f5f5f5;
        }
        
        .serial-number,
        .coin-info {
            padding: 10px;
        }
        
        .coin-image {
            width: 30px;
            height: 30px;
            margin-right: 10px;
        }
        
        #coinList {
            padding: 10px;
            white-space: nowrap;
            overflow: hidden;
            color: #333; /* Dark Grey text color for good visibility */
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8); /* Subtle text shadow for readability */
            font-family: 'Arial', sans-serif;
            margin: 0;
            overflow: hidden;
            background-color: #add8e6; /* Blue background color */
            border: 1px solid #2980b9; /* Darker blue border */
            border-radius: 10px; /* Rounded corners */
        }
        #hi {
            margin-right: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 10px;
            background-color: #f5f5f5;
            display: inline-block;
        }

    </style>
</head>
<body>
<header>
    {% comment %} <img src="C:\Users\sunil\Documents\sunildjangoprojects\firstproject\templates\cosmos-atom-logo.png" alt="Icon"> {% endcomment %}
    <h1><b>Crypton Technologies</b></h1>
    <nav>
        <ul>
            <li><a href="#">Home</a></li>
            <li><a href="#">About</a></li>
            <li><a href="#">Services</a></li>
            <li><a href="#">Contact</a></li>
            <li><a href ="globalchart.html">global-chart</a></li>
            <li><a href="{% url 'crypto_predictor:table' %}">CryptoPrice Wall</a></li>
            <li><a href="{% url 'crypto_predictor:select_crypto' %}" id="futurePredictionsLink">Future Predictions</a></li>


            <li id="profileLink"></li> 
        </ul>
        <ul>
            <li><a href="login.php">Logout</a></li>
        </ul>
    </nav>
</header>
        
<marquee id="coinList" direction="left" behavior="scroll" scrollamount="15">Loading...</marquee>
<!-- <section class="hero">
    <h2>Welcome to My Project</h2>
    <p>A brief description of your project.</p>
       <a href="#" class="cta-button">Get Started</a>
</section> -->

<!-- Cryptocurrency Dashboard content starts here -->
<div id="container">
    <!-- Left Panel -->
    <div id="leftPanel">
        <!-- Content for the left panel -->
        <h2>Top 100 Currencies</h2>
        <div id="currencyContainer">
            <table id="currencyMenu" class="currency-menu">
                <thead>
                <tr class="table-header">
                    <th class="serial-number">S.No.</th>
                    <th class="coin-info">Currency</th>
                    <th class="coin-info">Coin Image</th>
                    <th class="coin-info">Market Cap</th>
                </tr>
                </thead>
                <tbody id="currencyList" style="cursor: pointer;">
                <!-- Currency list items will be added dynamically here -->
                </tbody>
            </table>
        </div>

    </div>

    <!-- Right Panel -->
    <div id="rightPanel">
        <div class="container">
            <h2>Cryptocurrency Price Prediction</h2>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Search for a cryptocurrency">
                <ul id="searchResults"></ul>
            </div>
            <div id="selectedCurrency">
                <!-- Content for selected currency -->
            </div>
            <div class="charts-container">
                <div id="chartContainer" class="chart"></div>
                <div id="comparisonChartContainer" class="chart"></div>
            </div>
        </div>
    </div>
</div>

<div class="content-section">
    <h2>About Us</h2>
    <p>
        We are a dedicated team of cryptocurrency enthusiasts and data scientists, passionate about exploring the potential of blockchain technology and helping individuals make informed investment decisions. Our goal is to provide accurate and reliable price predictions for various cryptocurrencies, utilizing advanced prediction models and machine learning algorithms.
        <br><br>
        <u>Our Team Members:</u>
        <br><br>
        1.Akilan K: Documentation and Presentation
        <br><br>
        
        2.Sunilraj B: Backend and Functionalities
        <br><br>
        
        3.Sakthivel M: Frontend Frameworks and UI
        <br><br>
        
        Together, we form a well-rounded team with a blend of technical expertise, data analysis skills, and market insights. By leveraging our collective knowledge and utilizing cutting-edge prediction models, we strive to deliver reliable cryptocurrency price predictions that can assist investors in making informed decisions in the dynamic and ever-changing crypto market.
    </p>
</div>
<footer>
    <div class="social-icons">
        <div>
            <img class="icon" src="https://cdn3.iconfinder.com/data/icons/2018-social-media-logotypes/1000/2018_social_media_popular_app_logo_instagram-256.png"></img>
        </div>
        <div>
            <img class="icon" src="https://images-ext-2.discordapp.net/external/xXNauE9JrcYLj3bbGP663zkGDa-l-oAoOmTeUKGYarI/https/cdn3.iconfinder.com/data/icons/2018-social-media-logotypes/1000/2018_social_media_popular_app_logo-whatsapp-256.png?width=308&height=308"></img>
        </div>
        <div>
            <img class="icon" src="https://cdn4.iconfinder.com/data/icons/social-media-icons-the-circle-set/48/twitter_circle-256.png"></img>
        </div>
        <div>
            <img class="icon" src="https://images-ext-2.discordapp.net/external/01t1pvJqAf2kWiitIGDa0TLfAB1FHd-gDpf1oSXz5G8/https/cdn1.iconfinder.com/data/icons/social-media-2285/512/Colored_Facebook3_svg-256.png?width=308&height=308"></img>
        </div>
    </div>
    <!-- <div class="contact-details">
            <p>info@example.com</p>
            <p>+1 123-456-7890</p>
    </div> -->
    <p>&copy; 2023 My Project. All rights reserved.</p>
</footer>

<!-- Include JavaScript code from the Cryptocurrency Dashboard -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="https://cdn.jsdelivr.net/npm/regression/dist/regression.js"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts@3.28.0/dist/apexcharts.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% comment %} <script src="idejsrec1.js"></script> {% endcomment %}
<script src="{% static 'idejsrec1.js' %}"></script>
<script>
    // Check if the user is logged in and display the appropriate links
    var loggedIn = true; // Set this to true or false based on the user's login status

    function displayProfileSection() {
        var profileLink = document.getElementById("profileLink");
        var logoutSection = document.getElementById("logoutSection");

        if (loggedIn) {
            profileLink.innerHTML = `<a href="#">Profile</a>`;
            logoutSection.innerHTML = `<a href="#" onclick="logout()">Logout</a>`;
        } else {
            profileLink.innerHTML = `<a href="form/login.html">Login</a>`;
            logoutSection.innerHTML = `<a href="form/signup.html">Sign Up</a>`;
        }
    }

    // Function to handle logout
    function logout() {
        // Perform logout operation here

        // Redirect the user to the login page
        window.location.href = "login.php";
    }

    // Call the function to display the profile section on page load
    displayProfileSection();
</script>
<script>
    let cryptocurrencies = [];

function displayTopCurrencies(currencies) {
    const currencyMenu = document.getElementById('currencyList');
    currencyMenu.innerHTML = '';

    currencies.forEach((currency, index) => {
        if (index < 100) {
            const listItem = document.createElement('tr');
            listItem.classList.add('currency-item');

            const serialNumber = document.createElement('td');
            serialNumber.classList.add('serial-number');
            serialNumber.textContent = index + 1 + '. ';
            listItem.appendChild(serialNumber);

            const currencyName = document.createElement('td');
            currencyName.classList.add('coin-info');
            currencyName.textContent = currency.name;
            listItem.appendChild(currencyName);

            const coinImage = document.createElement('td');
            coinImage.classList.add('coin-info');
            const imageElement = document.createElement('img');
            imageElement.classList.add('coin-image');
            imageElement.src = currency.image;
            imageElement.alt = 'Coin Image';
            coinImage.appendChild(imageElement);
            listItem.appendChild(coinImage);
            //
            // const marketCap = document.createElement('td');
            // marketCap.classList.add('coin-info');
            // marketCap.textContent = '$' + currency.marketCap;
            // listItem.appendChild(marketCap);

            const marketCap = document.createElement('td');
            marketCap.classList.add('coin-info');
            marketCap.textContent = '$' + currency.market_cap;
            listItem.appendChild(marketCap);


            listItem.addEventListener('click', () => {
                fetchCurrencyDetails(currency.id);
            });
            adjustLeftPanelHeight();
            currencyMenu.appendChild(listItem);

        }
    });
}
function adjustLeftPanelHeight() {
    const leftPanel = document.getElementById('leftPanel');
    const currencyContainer = document.getElementById('currencyContainer');

    leftPanel.style.height = currencyContainer.offsetHeight + 'px';
}


// Update the fetchCryptocurrencyData function to call displayTopCurrencies
function fetchCryptocurrencyData() {
    fetch(
        'https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=100&page=1'
    )
        .then((response) => response.json())
        .then((data) => {
            cryptocurrencies = data;
            displayCryptocurrencies(data);
            displayTopCurrencies(data);
        })
        .catch((error) => console.error('Error:', error));
}


function processData(data) {
    const prices = data.map((entry) => entry[1]);
    return prices;
}

// Display the cryptocurrency data in the search results
function displayCryptocurrencies(data) {
    const searchResults = document.getElementById('searchResults');
    searchResults.innerHTML = '';

    data.forEach((coin) => {
        const listItem = document.createElement('li');
        listItem.value = coin.symbol;

        const coinImage = document.createElement('img');
        coinImage.src = coin.image;
        coinImage.alt = 'Coin Image';
        coinImage.className = 'coin-image';

        const coinInfo = document.createElement('div');
        coinInfo.className = 'coin-info';
        const coinName = document.createElement('span');
        coinName.textContent = coin.name;
        const coinSymbol = document.createElement('span');
        coinSymbol.textContent = coin.symbol;

        coinInfo.appendChild(coinImage);
        coinInfo.appendChild(coinName);
        coinInfo.appendChild(coinSymbol);

        listItem.appendChild(coinInfo);
        listItem.addEventListener('click', () => {
            fetchCurrencyDetails(coin.id);
        });

        searchResults.appendChild(listItem);
    });
}

// Linear regression prediction model
function predictPrice(historicalPrices) {
    const data = historicalPrices.map((price, index) => [index, price]);
    const result = regression.linear(data);
    const lastDataPoint = data[data.length - 1];
    const predictedPrice = result.predict([lastDataPoint[0] + 1])[1];

    return predictedPrice;
}
function fetchCurrencyDetails(currencyId) {
    Promise.all([
        fetch(`https://api.coingecko.com/api/v3/coins/${currencyId}/market_chart?vs_currency=usd&days=30&interval=daily`),
        fetch(`https://api.coingecko.com/api/v3/coins/${currencyId}`)
    ])
        .then(responses => Promise.all(responses.map(response => response.json())))
        .then(data => {
            const historicalPrices = data[0].prices.map(entry => entry[1]);
            const currentPrice = data[1].market_data.current_price.usd;
            const imageUrl = data[1].image.large;
            const movingAverage7Days = calculateMovingAverage(historicalPrices, 7);
            const movingAverage30Days = calculateMovingAverage(historicalPrices, 30);
            const rsi = calculateRSI(historicalPrices);
            const bollingerBands = calculateBollingerBands(historicalPrices);
            const priceChange1Day = calculatePriceChange(historicalPrices, 1);
            const priceChange7Days = calculatePriceChange(historicalPrices, 7);
            const volumeChange1Day = calculateVolumeChange(historicalPrices, 1);
            const volumeChange7Days = calculateVolumeChange(historicalPrices, 7);
            //
            // const selectedCurrency = document.getElementById('selectedCurrency');
            // selectedCurrency.innerHTML = '';

            const selectedCurrency = document.getElementById('selectedCurrency');
            selectedCurrency.innerHTML = '';

            const coinInfo = document.createElement('div');
            coinInfo.className = 'coin-info';

            const coinImageContainer = document.createElement('div');
            coinImageContainer.className = 'coin-image-container';
            const coinImage = document.createElement('img');
            coinImage.id = 'coinImage';
            coinImage.src = imageUrl;
            coinImage.alt = 'Coin Image';
            coinImageContainer.appendChild(coinImage);

            const currentPriceElement = document.createElement('div');
            currentPriceElement.id = 'currentPrice';
            currentPriceElement.className = 'info-item';
            currentPriceElement.textContent = 'Current Price: $' + currentPrice;

            const predictedPriceElement = document.createElement('div');
            predictedPriceElement.id = 'predictedPrice';
            predictedPriceElement.className = 'info-item';

            const rollingWindowPrices = historicalPrices.slice(-365); // Use the last 365 days of data as the rolling window
            const predictedPrice = predictPrice(rollingWindowPrices);
            predictedPriceElement.textContent = 'Predicted Price: $' + predictedPrice.toFixed(2);

            coinInfo.appendChild(coinImageContainer);
            coinInfo.appendChild(currentPriceElement);
            coinInfo.appendChild(predictedPriceElement);

            selectedCurrency.appendChild(coinInfo);

            renderChart(historicalPrices);
            renderComparisonChart(currentPrice, predictedPrice);
        })
        .catch(error => console.error('Error:', error));
}
// Helper functions for feature engineering
function calculateMovingAverage(prices, windowSize) {
    const movingAverages = [];
    for (let i = windowSize - 1; i < prices.length; i++) {
        const sum = prices.slice(i - windowSize + 1, i + 1).reduce((acc, entry) => acc + entry.price, 0);
        const average = sum / windowSize;
        movingAverages.push(average);
    }
    return movingAverages;
}

function calculateRSI(prices) {
    const gains = [];
    const losses = [];

    for (let i = 1; i < prices.length; i++) {
        const priceDiff = prices[i].price - prices[i - 1].price;
        if (priceDiff > 0) {
            gains.push(priceDiff);
            losses.push(0);
        } else {
            gains.push(0);
            losses.push(-priceDiff);
        }
    }

    const avgGain = gains.reduce((acc, val) => acc + val, 0) / gains.length;
    const avgLoss = losses.reduce((acc, val) => acc + val, 0) / losses.length;

    const rs = avgGain / avgLoss;
    const rsi = 100 - (100 / (1 + rs));
    return rsi;
}

function calculateBollingerBands(prices) {
    const windowSize = 20;
    const stdDeviations = 2;

    const smas = calculateMovingAverage(prices, windowSize);
    const deviations = [];

    for (let i = windowSize - 1; i < prices.length; i++) {
        const sumOfSquares = prices
            .slice(i - windowSize + 1, i + 1)
            .reduce((acc, entry) => acc + Math.pow(entry.price - smas[i], 2), 0);
        const standardDeviation = Math.sqrt(sumOfSquares / windowSize);
        deviations.push({
            upper: smas[i] + stdDeviations * standardDeviation,
            lower: smas[i] - stdDeviations * standardDeviation,
        });
    }

    return deviations;
}

function calculateSimpleMovingAverage(prices, windowSize) {
    const smas = [];

    for (let i = windowSize - 1; i < prices.length; i++) {
        const sum = prices.slice(i - windowSize + 1, i + 1).reduce((acc, entry) => acc + entry.price, 0);
        const average = sum / windowSize;
        smas.push(average);
    }

    return smas;
}

function calculatePriceChange(prices, interval) {
    const priceChanges = [];

    for (let i = interval; i < prices.length; i++) {
        const currentPrice = prices[i].price;
        const previousPrice = prices[i - interval].price;
        const priceChange = ((currentPrice - previousPrice) / previousPrice) * 100;
        priceChanges.push(priceChange);
    }

    return priceChanges;
}

function calculateVolumeChange(prices, interval) {
    const volumeChanges = [];

    for (let i = interval; i < prices.length; i++) {
        const currentVolume = prices[i].volume;
        const previousVolume = prices[i - interval].volume;
        const volumeChange = ((currentVolume - previousVolume) / previousVolume) * 100;
        volumeChanges.push(volumeChange);
    }

    return volumeChanges;
}

// Usage example
function generateFeatures(prices) {
    const movingAverages = calculateMovingAverage(prices, 10);
    const rsi = calculateRSI(prices);
    const bollingerBands = calculateBollingerBands(prices);
    const sma = calculateSimpleMovingAverage(prices, 20);
    const priceChanges = calculatePriceChange(prices, 1);
    const volumeChanges = calculateVolumeChange(prices, 1);

    // Use the generated features for further analysis or modeling
    console.log('Moving Averages:', movingAverages);
    console.log('RSI:', rsi);
    console.log('Bollinger Bands:', bollingerBands);
    console.log('SMA:', sma);
    console.log('Price Changes:', priceChanges);
    console.log('Volume Changes:', volumeChanges);
}

// Example data
// const prices = [
//     { price: 100, volume: 1000 },
//     { price: 110, volume: 1200 },
//     { price: 120, volume: 1500 },
//     // Add more price entries...
// ];
const prices = [];

// Function to fetch prices from the Binance API
async function fetchBinancePrices() {
    try {
        const response = await fetch('https://api.binance.com/api/v3/ticker/price');
        const data = await response.json();
        return data.map(entry => ({ price: parseFloat(entry.price), volume: parseFloat(entry.volume) }));
    } catch (error) {
        console.error('Error fetching Binance prices:', error);
        return [];
    }
}

// Example usage
async function updatePricesAndFeatures() {
    const binancePrices = await fetchBinancePrices();
    
    if (binancePrices.length > 0) {
        // Update the prices array
        prices.length = 0; // Clear existing prices
        Array.prototype.push.apply(prices, binancePrices);

        // Generate features based on the updated price data
        generateFeatures(prices);
    } else {
        console.error('No Binance prices data available.');
    }
}

// Call the function to update prices and features
updatePricesAndFeatures();

// Generate features based on the price data
generateFeatures(prices);

// Render the chart
let chart = null;
function renderChart(prices) {
    const dates = generateDates(prices.length);

    const options = {
        series: [
            {
                name: 'Price',
                data: prices,
            },
        ],
        chart: {
            type: 'line',
            height: 350,
        },
        xaxis: {
            type: 'datetime',
            categories: dates,
        },
    };

    if (chart === null) {
        // Create a new chart instance
        chart = new ApexCharts(
            document.querySelector('#chartContainer'),
            options
        );
        chart.render();
    } else {
        // Update the series data of the existing chart
        chart.updateSeries(options.series);
    }
}

// Render the comparison chart
let comparisonChart = null;
function renderComparisonChart(currentPrice, predictedPrice) {
    const chartData = [
        {
            x: 'Current Price',
            y: currentPrice,
        },
        {
            x: 'Predicted Price',
            y: predictedPrice,
        },
    ];

    const options = {
        series: [
            {
                data: chartData,
            },
        ],
        chart: {
            type: 'bar',
            height: 350,
        },
        plotOptions: {
            bar: {
                horizontal: true,
            },
        },
        dataLabels: {
            enabled: true,
            formatter: function (val) {
                return '$' + val.toFixed(2);
            },
            style: {
                fontSize: '12px',
                fontWeight: 'bold',
                colors: ['#000'],
            },
        },
        xaxis: {
            categories: ['Price'],
        },
    };

    if (comparisonChart === null) {
        // Create a new chart instance
        comparisonChart = new ApexCharts(
            document.querySelector('#comparisonChartContainer'),
            options
        );
        comparisonChart.render();
    } else {
        // Update the series data of the existing chart
        comparisonChart.updateSeries(options.series);
    }
}

// Generate an array of dates based on the number of data points
function generateDates(numPoints) {
    const startDate = new Date();
    startDate.setDate(startDate.getDate() - numPoints + 1);
    const dates = [];

    for (let i = 0; i < numPoints; i++) {
        const currentDate = new Date(startDate);
        currentDate.setDate(startDate.getDate() + i);
        dates.push(currentDate.getTime());
    }

    return dates;
}



let searchResultsVisible = false;

// Handle search input
function handleSearchInput() {
    const searchTerm = searchInput.value.toLowerCase();
    const searchResults = document.getElementById('searchResults');
    searchResults.innerHTML = '';

    if (searchTerm.length > 0) {
        const matchedCurrencies = cryptocurrencies.filter((coin) =>
            coin.name.toLowerCase().includes(searchTerm)
        );

        displayCryptocurrencies(matchedCurrencies);

        // Set the visibility state of the dropdown menu to true
        searchResultsVisible = true;
    } else {
        // Set the visibility state of the dropdown menu based on the previous state
        searchResultsVisible = searchResultsVisible;
    }

    // Update the display property of the dropdown menu based on the visibility state
    searchResults.style.display = searchResultsVisible ? 'block' : 'none';
}

// Add event listener to the search input
const searchInput = document.getElementById('searchInput');
searchInput.addEventListener('input', handleSearchInput);
fetch('https://api.binance.com/api/v3/ticker/price')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            const coinListContainer = document.getElementById('coinList');

            if (data && data.length > 0) {
                const coins = data.map(coin => `
                    <div id="hi">
                        <p>Symbol: ${coin.symbol}</p>
                        <p>Price: $${coin.price}</p>
                    </div>
                `);

                coinListContainer.innerHTML = coins.join('');
            } else {
                coinListContainer.innerHTML = '<p>No data available</p>';
            }
        })
        .catch(error => {
            console.error('Error fetching data:', error);
            document.getElementById('coinList').innerHTML = `<p>Error: ${error.message}</p>`;
        });

// Fetch cryptocurrency data and initialize the dashboard
fetchCryptocurrencyData();

</script>

</body>
</html>